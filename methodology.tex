\def\clim{$C_{lim}$}
\def\hlim{$h_{lim}$}
\def\c2{$C_2$}
\def\im{$I_m$}
\def\km{$K_m$}

% For numbering piecewise equations
\input cases

% Fancy fractions: \displaystyle

\cleardoublepage
\label[methodology]
\chap METHODOLOGY

In this chapter, the model development is described.
First, we show the mathematical equations that represent the transport of water and solutes and their uptake by the root (Section~\ref[model_description]). 
The numerical development with the applied boundary conditions are show in Section~\ref[numerical_implementation]. 
% LET'S STATE THAT WE ARE NOT USING THE PETER'S MODEL, BUT A NUMERICAL SOLUTION BASED ON HIS SOLUTION OF CONSTANT UPTAKE RATE
The numerical solutions for the zero \cite[liersolute] and constant uptake {\localcolor\Red LIKE PROPOSED BY \citeonline[willigen1]} models (used in the comparison with the proposed model) are show in Sections \ref[ZU] and \ref[CU].
Later, we present 
%Section \ref[analytical_models] that shows the analytical models that has been chosen to compare with the proposed model, followed by 
the description of the simulated scenarios (Section~\ref[scenarios]), a comparative analysis of the linear and non-linear approaches of the proposed model (Section~\ref[lu_nlu_comp]), as well as of the other numerical models (Section~\ref[model_comp]) and, finally, the methodology used for the sensitivity analysis (Section~\ref[sensitivity]).

%In this thesis, we will compare the proposed model with the original one \cite[liersolute], and  with analytical models of constant \cite[willigen1] and concentration dependent (MM) \cite[cushman] uptake, both considering steady-state condition with respect to water flow. 
%A numerical implementation of the constant uptake was developed, therefore, the numerical solutions for the concentration dependent, zero uptake and constant uptake models are shown.

\label[model_description]
\sec General model description

%Description of the model
%To get the desired results of solute concentration as a function of time and radial distance from the axial center, as well to compute the total amount of solute extracted by the plant in a prescribed time, 
%, that accounts for water and solute flow, respectively. 
The geometry of the soil-root system considers an uniformly distributed parallel cylindrical roots of radius $r_0$ and length $z$. 
To each root, a concentric cylinder of radius $r_m$ and length $z$ can be assigned to represent its extraction volume (Figure \ref[fig_rootzone]).

\medskip
\label[fig_rootzone]
\picw=11cm \cinspic root_zone.pdf
\caption/f {Schematic representation of the spatial distribution of roots in the root zone}
\medskip

The discretization needed for the numerical solution was made in the single root scale. 
As the extraction properties of the root are considered uniform along its length, and assuming no vertical differences in root density and fluxes, the cylinder can be represented by a circle. 
The extraction area was then subdivided into $n$ circular segments of variable size $\Delta_r$~(m), small near the root and increasing with distance, according to the equation \cite[liersolute]:
\label[eq_disc]
$$
\Delta_r = \Delta r_{min}+(\Delta r_{max}-\Delta r_{min}) \left( {r-r_0 \over r_m-r_0} \right)^S \eqmark
$$
%
where the subscripts 
in $\Delta_r$ 
indicate the minimum and maximum segment sizes defined by the user, and $S$ gives the rate at which the segment size increases. 
The parameters $r_0$ (m) is the root radius, and $r_m$ (m) is the root extraction zone, equal to the half-distance between roots, which relates to the root density $R$ (m m$^{-3}$) according to equation \ref[eq_rm].
This approach for the discretization has the advantage of determine smaller segments in regions that need more precision in the calculations (root soil interface) due to the greater variation of the flux properties. 
%It is specially advantageous when dealing with numerical stabilization and convergence problems. 
Figure~\ref[fig_scheme] shows the discretization resulted from Equation~\ref[eq_disc].

\medskip
\label[fig_scheme]
\picw=9.5cm \cinspic domain.pdf
\caption/f {Schematic representation of the discretized domain considered in the model. $\Delta r$ is the variable segment size, increasing with the distance from the root surface ($r_0$) to the half-distance between roots ($r_m$), and $n$ is the number of segments}
\medskip

A fully implicit numerical treatment was given to the water and solute balance equations \ref[eq_Richards] and \ref[eq_sol].
The Richards equation \ref[eq_Richards] for one-dimensional axis-symetric flow can be writen as
\label[eq_complete_richards]
$$
{\partial \theta \over \partial t} = {\partial \theta \over \partial H} {\partial H \over \partial t} = C_w(H) {\partial H \over \partial t} = {1 \over r}{\partial \over \partial r} \left[ r K(H,\theta) {\partial H \over \partial r} \right] \eqmark
$$
%
where the total hydraulic head ($H$) is the sum of pressure ($h$) and osmotic ($h_\pi$) heads and $C_w$ (m$^{-1}$) is the differential water capacity.
Relations between $K$, $\theta$ and $h$ are described by the van Genuchten equation system (Equations \ref[eq_theta] and \ref[eq_K]).
Analogous to \citeonline[vandam_feddes], Equation \ref[eq_complete_richards] can be solved using an implicit scheme of finite differences with the Picard iteractive process:
$$
\eqalignno{
\label[eq_disc_water]
C_i^{j+1,p-1} (H_i^{j+1,p}&-H_i^{j+1,p-1}) + \theta_i^{j+1,p-1}-\theta_i^j = {t^{j+1}-t^j \over r_i \Delta r_i} \times \cr
&\left[ 
r_{i-1/2}K_{i-1/2}^j {H_{i-1}^{j+1,p}-H_i^{j+1,p} \over r_i-r_{i-1}} 
- 
r_{i+1/2}K_{i+1/2}^j {H_{i}^{j+1,p}-H_{i+1}^{j+1,p} \over r_{i+1}-r_{i}} 
\right] &\eqmark
}
$$
%
where $i$ ($1 \leq i \leq n$) refers to the segment number, $j$ is the time step and $p$ the iteration level. 
The Picard's method is used to reduce inaccuracies in the implicit numerical solution for the $h$-based Equation \ref[eq_complete_richards] \cite[celia].

The solution for Equation \ref[eq_disc_water] results in prediction of pressure head in soil as a function of time and distance from the root surface. 
The boundary conditions considered were of flux density entering the root determined by the transpiration rate, for the inner segment; and of zero flux, for the outer segment.
The computer algorithm that solves the equation and applied boundary conditions are found on Appendix \ref[ap_water].

The convection-dispersion equation \ref[eq_sol], also for one-dimensional axis-symetric flow, can be writen as
\label[eq_complete_solute]
$$
r {\partial(\theta C) \over \partial t} = -{\partial \over \partial r} \biggl(r q C \biggr) + {\partial  \over \partial r} \left( r D {\partial C \over \partial r} \right). \eqmark
$$
%

Both boundary conditions are of the flux type, according to Equation \ref[eq_boundary_sol].
From the assumed geometry (Figure \ref[fig_scheme]) it follows that the boundary condition at the outer segment is that of zero solute flux ($q_s$):
\label[eq_bcrm]
$$
-D(\theta) {\partial C \over \partial r} + q C = q_s = 0\;{\rm ,} \quad t>0,\; r=r_m .\eqmark
$$

The boundary condition for solute transport at the root surface is that of concentration dependent solute uptake, 
%generated by the plant demand 
described by MM equation \ref[eq_MM1], with the following assumptions:
\begitems
\style n
%* Solute flux is governed by plant demand (which is constant)
* Solute uptake by mass flow of water is not controlled by the plant by other means but transpiration, thus the uptake by convection is passive;
* Plant regulates active uptake, thus the uptake by diffusion is plant regulated;
%* Uptake by convection is considered to be passive, and by diffusion, active;
* Plant demand is equal to the $I_m$ (mol m$^{-2}$ s$^{-1}$) parameter from MM equation;
* There is a soil solution concentration value (\clim, mol) that the solute flux limits the uptake.
\enditems

We assume that the plant demand for solute is constant, but not the uptake, in a way that solute uptake can be either greater or lesser than the demand, depending on the concentration in the soil solution at root surface (Figure \ref[fig_MM_mod]). 
If the concentration is bellow a certain limiting value (\clim), the uptake is limited by the solute flux, {\it i.e.} solute flux can not attend plant demand even with potential values of active uptake.
Additionally, solute uptake by mass flow of water can be higher than the plant demand in situations of high transpiration rate and/or for high soil water content. 
In that case, we assume that active uptake is zero and all uptake is done by the passive process. A concentration \c2 (mol) for this situation is calculated.
When the concentration is between \clim{} and \c2, the uptake is equal to the plant demand as a result of the sum of active and passive contributions to the uptake.
Assumption 1 states that passive uptake is not regulated by any physiological plant mechanisms and, in order to save metabolic energy, active uptake is regulated such that it works as a complementary mechanism of extraction to achieve plant demand, 
resulting in a lower active uptake contribution than that of its potential value.
%--IMPORTANT TO IMPROVE ASSUMPTIONS
%Ions and water move into the plant independently, reflecting entirely different physical-chemical forces; nevertheless, the water moving to the root carries ions in it. A portion of these ions is taken up by the plant by an independent mechanism. The remainder is left behind at the root surface or on the soil particles in the vicinity of the root where they represent a subsequent source of supply. 81.pdf, pg. 98
%This can explain the analysis of diffusion and convection (active and passive) separately.
Nevertheless, the effects of solute concentration inside the plant in solute uptake and plant demand are not considered in the model.
Consequently, a situation where the demand is diminished due to an excess of solute inside the plant is not considered, which can lead to overestimated predictions of the uptake.

A piecewise uptake function that considers the explicit assumptions was, then, formulated
\label[eq_MM_mod]
\numcases{q_{s0} =}
\label[eq_case1]
{I_m C_0 \over K_m+C_0}+q_0 C_0,&if $C_0 < C_{lim}$ \\
\label[eq_case2]
I_m, 				&if $C_{lim} \leq C \leq C_2$ \\
\label[eq_case3]
q_0 C, 				&if $C > C_2$
\endnumcases
%
with \clim{} determined by the positive root of
\label[eq_clim]
$$
C_{lim} = -{K_m \pm \left( {K_m}^2 + 4{I_m K_m / q_0} \right)^{1/2} \over 2 }, \eqmark
$$
%
and \c2 by
\label[eq_c2]
$$
C_2 = {I_m \over q_0}{\rm .} \eqmark
$$

\medskip
\label[fig_MM_mod]
\picw=13cm \cinspic MM_c.pdf
%\caption/f {Solute uptake piecewise equation \reff_MM_mod after assumptions made over original MM equation \ref[eq_MM1].}
\caption/f {Solute uptake piecewise equation \ref[eq_MM_mod] after assumptions made over original MM equation \ref[eq_MM1]. The thicker line is the actual uptake, the thiner lines represent active and passive contributions to the actual uptake, and the dotted lines are the plant demand and the potential active uptake}
\medskip

%IMPROVE IT AND EXPLAIN MORE
The non-linear part of the uptake function resides in Equation \ref[eq_case1]. As implicit numerical implementations of non-linear functions may result in solutions with stabilization issues, a linearization of Equation \ref[eq_case1] was made, which yields:
%Due to the difficulty of implement a numerical algorithm to the non-linear Equation \ref[eq_case1], a linearization was made, resulting in:
\label[eq_MM_linear]
$$
q_{s0} = (\alpha + q_0)\,C_0,\,\,\,\,{\rm if }\, C_0 < C_{lim}  \eqmark
$$
%
where $\alpha$ (m s$^{-1}$) and $q_0$ (m s$^{-1}$) are the active and passive contributions for the solute uptake slope $(\alpha+q_0)$.
%IMPROVE
This linearization is very similar to the one proposed by \citeonline[tinker], but does not considers concentration inside the plant.
The derivation of Equations \ref[eq_clim] to \ref[eq_MM_linear] can be found in Appendix \ref[ap_clim].

Finally, the boundary condition at the inner segment is that of concentration dependent solute flux at the root surface ($q_{s0}$) according to Equation \ref[eq_MM_mod] and \ref[eq_MM_linear] for non-linear and linear case, respectively:
\label[eq_inner_bound]
$$
-D(\theta) {\partial C \over \partial r} + q_0 C_0 = q_{s0}, \eqmark
%= {I_m C_0 \over K_m+C_0}+q_0 C_0\;{\rm ,} \quad t>0,\; r=r_0 \eqmark
$$
%
and the initial condition is of constant concentration ($C_{ini}$) for all segments:
$$
C = C_{ini}\;, \quad t=0,\; r=r_i,\; 1 \leq i \leq n. \eqmark
$$

\label[numerical_implementation]
\sec Numerical implementations of convection-dispersion equation

Here, we present the numerical discretization and the applied boundary conditions, together with the algorithm to find the solution of Equation \ref[eq_complete_solute] for both linear and non-linear cases.
%find a better place to put it
The mass balance equations are considered to have transient condition in respect to water and solute.

%IMPROVE
As mentioned in the introduction of this chapter, besides the development of the proposed model (concentration dependent solute uptake), we also developed a numerical solution for a constant uptake model \cite[willigen1], using the same discretization detailed in the previous section. 
Additionally, we present the numerical solution for the zero uptake model (developed by \citeonline[liersolute]), in which we are proposing modifications. 
Thus, from now on -- to avoid lengthy texts -- we will abbreviate zero uptake model, constant uptake model, linear concentrations dependent model and non-linear concentration dependent model as ZU, CU, LU, and NLU, respectively. 

%--
%In this thesis, we will compare the proposed model with the original one \cite[liersolute], and  with analytical models of constant \cite[willigen1] and concentration dependent (MM) \cite[cushman] uptake, both considering steady-state condition with respect to water flow. 
%A numerical implementation of the constant uptake was developed, therefore, the numerical solutions for the concentration dependent, zero uptake and constant uptake models are shown.

%MODIFY IT. Copyied from quirijn
In the numerical solutions, the combined water and solute movement is simulated iteratively. In a first step, the water movement towards the root is simulated, assuming salt concentrations from the previous time step. In a second step, the salt contents per segment are updated and new values for the osmotic head in all segments are calculated. The first step is then repeated with updated values for the osmotic heads. This process is repeated until the pressure head values and osmotic head values between iterations converge. Flowcharts containing the algorithm's logic is shown in the Appendix \ref[ap_flowchart].

\secc Concentration dependent solution (proposed model)

The implicit numerical discretization of Equation \ref[eq_complete_solute] yields:
$$
\eqalignno{
\label[eq_disc_sol]
\theta^{j+1}_i &C^{j+1}_i - \theta^j_i C^j_i = {\Delta t \over 2 r_i \Delta r_i} \times \cr
& \left\{ 
{r_{i-1/2} \over r_i-r_{i-1}} \left[ q_{i-1/2}(C^{j+1}_{i-1}\Delta r_i + C^{j+1}_{i}\Delta r_{i-1}) - 2D^{j+1}_{i-1/2}(C^{j+1}_i-C^{j+1}_{i-1}) \right]\right. - & \eqmark \cr
&\left. {r_{i+1/2} \over r_{i+1}-r_{i}} \left[ q_{i+1/2}(C^{j+1}_{i}\Delta r_{i+1} + C^{j+1}_{i+1}\Delta r_{i}) - 2D^{j+1}_{i+1/2}(C^{j+1}_{i+1}-C^{j+1}_{i}) \right] 
\right\}
}
$$

The solution to Equation \ref[eq_disc_sol] can be made by applying it to each segment. 
The solution is the concentration at each segment ($C_i^{j+1}$) that can be found by solving the tridiagonal matrix as follows
\label[matrix]
$$
\left [ \matrix{
 b_1 & c_1 & & & &  \cr
 a_2 & b_2 & c_2 & & &  \cr
  & a_3 & b_3 & c_3 & &  \cr
  &  & \ddots & \ddots & \ddots &  \cr
  &  & & a_{n-1} & b_{n-1} & c_{n-1}  \cr
  &  & & & a_{n} & b_{n}  \cr}  \right]
\left [ \matrix{
 C^{j+1}_1 \cr
 C^{j+1}_2 \cr
 C^{j+1}_3 \cr
 \vdots \cr
 C^{j+1}_{n-1} \cr
 C^{j+1}_n \cr} \right ]
=
\left [ \matrix{
 f_1 \cr
 f_2 \cr
 f_3 \cr
 \vdots \cr
 f_{n-1} \cr
 f_n \cr} \right ]
 \eqmark
$$
%
with $f_i \hbox{(mol m$^{-2}$)}$ defined
%, unless specified otherwise, 
as
$$
f_i = r_i \theta^j_ i C^j_i \eqmark
$$
%
and $a_i\, \hbox{(m)}$, $b_i\, \hbox{(m)}$ and $c_i\, \hbox{(m)}$ are defined according to the respective segments 
%and model type 
as described in the following.

\seccc The intermediate nodes ($i = 2\hbox{ to }i = n-1$)

Rearrangement of Eq. \ref[eq_disc_sol] to eq. \ref[matrix] results in the coefficients:
$$
\eqalignno{
\label[eq_int_nodes1]
a_i &= -{r_{i-1/2} (2D^{j+1}_{i-1/2} + q_{i-1/2} \Delta r_i)\Delta t \over 2(r_{i}-r_{i-1})\Delta r_i} & \eqmark \cr
b_i &= r_i \theta^{j+1}_i + {\Delta t \over 2 \Delta r_i} 
\left[
{r_{i-1/2} \over (r_i-r_{i-1})} (2D^{j+1}_{i-1/2} - q_{i-1/2} \Delta r_{i-1}) + \right. \cr
&\left.{r_{i+1/2} \over (r_{i+1}-r_{i})} (2D^{j+1}_{i+1/2} + q_{i+1/2} \Delta r_{i+1}) 
\right] & \eqmark \cr
\label[eq_int_nodes3]
c_i &= -{r_{i+1/2} \Delta t \over 2 \Delta r_i (r_{i+1}-r_i)} (2D^{j+1}_{i+1/2} - q_{i+1/2} \Delta r_i) & \eqmark \cr
}
$$

\seccc The outer boundary ($i=n$)

Applying boundary condition of zero solute flux, the third and forth terms from the right hand side of Eq. \ref[eq_disc_sol] are equal to zero. Thus, the solute balance for this segment is written as:
$$
\eqalignno{
\label[outer]
\theta^{j+1}_n &C^{j+1}_n - \theta^j_n C^j_n = {\Delta t \over 2 r_n \Delta r_n} \times \cr
& \left\{ 
{r_{n-1/2} \over r_n-r_{n-1}} \left[ q_{n-1/2}(C^{j+1}_{n-1}\Delta r_n + C^{j+1}_{n}\Delta r_{n-1}) -  2D^{j+1}_{n-1/2}(C^{j+1}_n-C^{j+1}_{n-1}) \right]
\right\} & \eqmark
}
$$

Rearrangement of Eq. \ref[outer] to Eq. \ref[matrix] results in the coefficients:
$$
\eqalignno{
a_n &= -{r_{n-1/2} (2D^{j+1}_{n-1/2} + q_{n-1/2} \Delta r_n)\Delta t \over 2(r_{n}-r_{n-1})\Delta r_n} & \eqmark \cr
b_n &= r_n \theta^{j+1}_n + {\Delta t \over 2 \Delta r_n} 
\left[
{r_{n-1/2} \over (r_n-r_{n-1})} (2D^{j+1}_{n-1/2} + q_{n-1/2} \Delta r_{n-1})
\right] & \eqmark
}
$$

\seccc The inner boundary ($i=1$)

\begitems
\style a
* {\bf Linear concentration dependent model (LU)}

Applying boundary conditions of linear concentration dependent solute flux, the first and second terms of the right-hand side of Eq. \ref[eq_disc_sol] are equal to $-(\alpha + q_0)C^{j+1}_1 \Delta r_1$ while $C < C_{lim}$ and $C > C_2$:
$$
\eqalignno{
\label[LU]
\theta^{j+1}_1 &C^{j+1}_1 - \theta^j_1 C^j_1 = {\Delta t \over 2 r_1 \Delta r_1} \times \cr
& \left\{  
{r_{1-1/2} \over r_{1}-r_{0}} \left[-(\alpha + q_0)\right] C^{j+1}_1 \Delta r_1 \right. - & \eqmark \cr
& \left. { r_{1+1/2} \over r_{2}-r_{1}} \left[ q_{1+1/2}(C^{j+1}_{1}\Delta r_{2} + C^{j+1}_{2}\Delta r_{1}) - 2D^{j+1}_{1+1/2}(C^{j+1}_{2}-C^{j+1}_{1}) \right] 
\right\} &
}
$$
%
When $C=0$ the solute flux is set to zero and the equation is equal to Eq. \ref[lier] (zero uptake). While $C_{lim}~\leq~C~\leq~C_2$, the solute flux density is constant and the equation is equal to Eq. \ref[will] (constant uptake).

Rearrangement of Eq. \ref[LU] to Eq. \ref[matrix] results in the following coefficients:
$$
\eqalignno{
b_1 &= r_1 \theta^{j+1}_1 + {\Delta t \over 2 \Delta r_1} \left[ {r_{1+1/2} \over (r_2-r_1)} (2D^{j+1}_{1+1/2} + q_{i+1/2} \Delta r_2) -{r_{1-1/2} \over r_{1}-r_{0}}\left(\alpha + q_0 \right) \Delta r_1\right] & \eqmark \cr 
c_1 &= -{r_{1+1/2} \Delta t \over 2 \Delta r_1 (r_2-r_1)} (2D^{j+1}_{1+1/2} - q_{1+1/2} \Delta r_1) & \eqmark
}
$$
% bs(1) = dt/(2.*dr(1)) * ((Imm/c_lim*dr(1)+q(0)*dr(1))/(2.*PI*R*z*r(0)) + rsup(1)/(r(2)-r(1)) * (2*D(1)+q(1)*dr(2)) )+ r(1)*theta(1)

* {\bf Nonlinear concentration dependent model (NLU)}

Applying boundary conditions of nonlinear concentration dependent solute flux, the first and second term of the right-hand side of Eq. \ref[eq_disc_sol] are equal to $-({I_m \over 2 \pi r_0 R(K_m +C^{j+1}_1)} + q_0)C^{j+1}_1 \Delta r_1$ while $C < C_{lim}$ and $C > C_2$:
$$
\eqalignno{
\label[NLU]
\theta^{j+1}_1 &C^{j+1}_1 - \theta^j_1 C^j_1 = {\Delta t \over 2 r_1 \Delta r_1} \times \cr
& \left\{  
{r_{1-1/2} \over r_{1}-r_{0}} \left[-({I_m \over 2 \pi r_0 R(K_m +C^{j+1}_1)} + q_0)\right] C^{j+1}_1 \Delta r_1 \right. - & \eqmark \cr
& \left. { r_{1+1/2} \over r_{2}-r_{1}} \left[ q_{1+1/2}(C^{j+1}_{1}\Delta r_{2} + C^{j+1}_{2}\Delta r_{1}) - 2D^{j+1}_{1+1/2}(C^{j+1}_{2}-C^{j+1}_{1}) \right] 
\right\} & 
}
$$

Rearrangement of Eq. \ref[NLU] to Eq. \ref[matrix] results in the following coefficients:
$$
\eqalignno{
\label[b1]
b_1 = r_1 \theta^{j+1}_1 + {\Delta t \over 2 \Delta r_1} &\left[ {r_{1+1/2} \over (r_2-r_1)} (2D^{j+1}_{1+1/2} + q_{i+1/2} \Delta r_2) - \right. \cr
& \left. {r_{1-1/2} \over r_{1}-r_{0}}\left({I_m \over 2 \pi r_0 R(K_m +C^{j+1}_1)} + q_0 \right) \Delta r_1\right] & \eqmark \cr
c_1 = -{r_{1+1/2} \Delta t \over 2 \Delta r_1 (r_2-r_1)} &(2D^{j+1}_{1+1/2} - q_{1+1/2} \Delta r_1) & \eqmark
}
$$

\enditems

The value of $C^{j+1}_1$ in Equation \ref[b1] is found using the iterative Newton-Raphson method. 
%Note that since this is a one-dimensional microscopic model, it is assumed that the root has the same characteristcs in all vertical soil profile (along its vertical axis), thus, water and solute transport from soil towards the roots and uptakes are occurring at the same rate in the vertical profile. It is possible to couple this model in another one that has discretized soil layers. For a 2D model (depth and radial distance), the solutions presented here are applied in each layer independently. For a 1D model (only depth), an average of water and solute content through the horizontal profile has to be determined.

\label[ZU]
\secc Zero uptake solution (ZU)

The zero uptake solution is the original model presented by \citeonline[liersolute]. The numerical discretization is according to Equation \ref[eq_disc_sol] and the intermediate nodes are analogous to Equations \ref[eq_int_nodes1] to \ref[eq_int_nodes3]. 
The only difference is the boundary at root surface (Equation~\ref[eq_inner_bound]), which is of zero solute flux:
$$
q_{s0}=0 \eqmark
$$

\seccc The inner boundary ($i=1$)

Applying boundary condition of zero solute flux, the first and second term of the right-hand side of Eq. \ref[eq_disc_sol] are equal to zero:
$$
\eqalignno{
\label[lier]
\theta^{j+1}_1 &C^{j+1}_1 - \theta^j_1 C^j_1 = {\Delta t \over 2 r_1 \Delta r_1} \times \cr
& \left\{ 
{r_{1+1/2} \over r_{2}-r_{1}} \left[ -q_{1+1/2}(C^{j+1}_{1}\Delta r_{2} + C^{j+1}_{2}\Delta r_{1}) + 2D^{j+1}_{1+1/2}(C^{j+1}_{2}-C^{j+1}_{1}) \right] 
\right\} & \eqmark
}
$$

Rearrangement of Eq. \ref[lier] to Eq. \ref[matrix] results in the following coefficients:
$$
\eqalignno{
b_1 &= r_1 \theta^{j+1}_1 + {\Delta t \over 2 \Delta r_1} \left[ {r_{1+1/2} \over (r_2-r_1)} (2D^{j+1}_{1+1/2} + q_{1+1/2} \Delta r_2) \right] & \eqmark \cr
c_1 &= -{r_{1+1/2} \Delta t \over 2 \Delta r_1 (r_2-r_1)} (2D^{j+1}_{1+1/2} - q_{1+1/2} \Delta r_1) & \eqmark \cr
}
$$

\label[CU]
\secc Constant uptake solution (CU)

The constant uptake solution is was proposed by \citeonline[willigen1]. The numerical discretization is according to Equation \ref[eq_disc_sol] and the intermediate nodes are analogous to Equations \ref[eq_int_nodes1] to \ref[eq_int_nodes3]. 
The only difference is the boundary at root surface, which is of constant solute flux.
The only difference is the boundary at root surface (Equation~\ref[eq_inner_bound]), which is of constant solute flux:
$$
q_{s0}=I_m. \eqmark
$$

\seccc The inner boundary ($i=1$)

Applying boundary conditions of constant solute flux, the first and second term of the right-hand side of Eq. \ref[eq_disc_sol] are equal to $-{I_m \over 2 \pi r_0 R}\Delta r_1$ while $C > 0$:
$$
\eqalignno{
\label[will]
\theta^{j+1}_1 &C^{j+1}_1 - \theta^j_1 C^j_1 = {\Delta t \over 2 r_1 \Delta r_1} \times \cr
& \left\{  
{r_{1-1/2} \over r_{1}-r_{0}} \left(-{I_m \over 2 \pi r_0 R}\right) \Delta r_1 - \right. & \eqmark \cr 
& \left. { r_{1+1/2} \over r_{2}-r_{1}} \left[ q_{1+1/2}(C^{j+1}_{1}\Delta r_{2} + C^{j+1}_{2}\Delta r_{1}) - 2D^{j+1}_{1+1/2}(C^{j+1}_{2}-C^{j+1}_{1}) \right] 
\right\} & 
}
$$
%
When $C = 0$ the solute flux is set to zero and the equation becomes equal to Eq. \ref[lier].

Rearrangement of Eq. \ref[will] to Eq. \ref[matrix] results in the following coefficients:
$$
\eqalignno{
b_1 &= r_1 \theta^{j+1}_1 + {\Delta t \over 2 \Delta r_1} \left[ {r_{1+1/2} \over (r_2-r_1)} (2D^{j+1}_{1+1/2} + q_{1+1/2} \Delta r_2) \right] & \eqmark \cr
c_1 &= -{r_{1+1/2} \Delta t \over 2 \Delta r_1 (r_2-r_1)} (2D^{j+1}_{1+1/2} - q_{1+1/2} \Delta r_1) & \eqmark \cr
f_1 &= r_1 \theta^j_1 C^j_1 - {r_{1-1/2} \over r_{1}-r_{0}} I_m {\Delta t \over 4 \pi r_0 R} & \eqmark
}
$$




\label[analytical_models]
\sec Analytical models

Here we present the analytical models used in the comparisons to the proposed model. An computational implementation were made to each model.

{\localcolor\Red MAYBE IT IS NOT NECESSARY TO SHOWN THE ANALYTICAL EQUATIONS, JUST CITE THEM}

%\secc Concentration dependent solution

%\secc Constant uptake solution

%\sec Other models

\label[scenarios]
\sec Simulation scenarios

%PUT IT SOMEWHERE
The default values for $\Delta r_{min}$, $\Delta r_{max}$ and $S$ are of 10$^{-8}$ m, 5 10$^{-4}$ m and 0.5, resulting in 24, 73 and 228 segments for the high, medium and low root density simulations, respectively. 
However, further reductions of the segment size might be needed in case of stabilization problems in the solute transport equation.

The simulations were performed using the hydraulic parameters from the Dutch Staring series \cite[wosten] for three different soils types, as listed in Table \ref[soils]. 
The general system parameters for the different scenarios are listed in Table \ref[general_param] and values for the Michaelis-Menten (MM) parameters in Table \ref[MMparam]. Values of root length density, salt content and relative transpiration were chosen to change, reflecting different possible scenarios that would occur in a practical situation. The chosen MM parameters were for K$^+$ solute.

\input tables/soils

\input tables/general_param

\input tables/MMparam



\label[lu_nlu_comp]
\sec Analysis of linear and nonlinear approaches

To analyze the differences between the two proposed models (linear and nonlinear), the absolute and relative differences were calculated as follows:
$$
\eqalignno{
\label[error_abs]
di\!f\!\!f_{abs} &= \sum_{t=1}^{t_{end}} C\!L_t - C\!N\!L_t  & \eqmark \cr
\label[error_rel] 
di\!f\!\!f_{rel} &= {\sum_{t=1}^{t_{end}} C\!L_t - C\!N\!L_t \over \sum_{t=1}^{t_{end}} C\!L_t} & \eqmark \cr
}
$$
%
where $C\!L_t$ and $C\!N\!L_t$ are the solute concentration in soil water for LU and NLU, respectvely, at a given time $t$, and $t_{end}$ is the end time of the simulation.

%The equations are the same of absolute and relative errors but since we are analyzing differences instead of errors (there is not a standard model), we called it differences.

%This section describes how the linear (LU) and nonlinear (NLU) solutions simulate the transport of water and solutes in the soil-plant-atmosphere system. 
The analysis of the results was made in order to choose one out of the two models in further simulations. 
NLU solution uses the MM equation \ref[eq_MM_mod], takes longer to run -- due to an additional iterative process --, and is more susceptible to stabilization problems in the results. 
LU is a simplified version of the MM equation in which the solute uptake rate for the situation $C<C_{lim}$ is smaller when compared to the original nonlinear equation (details in Appendix \ref[ap_l_nl_fluxes]), it has no stabilization problems and runs faster. 
Therefore, the objective of this section is to analyze the differences between the results of the two models and check if they change significantly the results. 
For that, four different general scenarios were chosen (using the parameters listed in Table 2, with  loam soil) as listed below:

\begitems
%\style i
* Scenario 1: Medium root length density, High concentration and High potential transpiration
* Scenario 2: Medium root length density, High concentration and Low potential transpiration
* Scenario 3: Low root length density, High concentration and High potential transpiration
* Scenario 4: Medium root length density, Low concentration and High potential transpiration
\enditems

The default values for $\Delta r_{min}$, $\Delta r_{max}$ and $S$, on Equation \ref[eq_disc], are of 10$^{-8}$ m, 5~10$^{-4}$ m and 0.5, resulting in 24, 73 and 228 segments for the high, medium and low root density simulations, respectively. However, further reductions of the segment size might be needed in case of stabilization problems in the solute transport equation.

\secc Statistical difference

Also, the Mann--Whitney U test was made with two datasets (concentration and cumulative uptake) for the two models. 
The choice of this test is due to the fact that the distributions for both datasets are not normal, the pairs (concentration for LU and for NLU and cumulative uptake for LU and NLU) are distinct and do not affect each other. 
This test can decide whether each pair is identical without assuming them to follow the normal distribution (nonparametric test). 
The null hypothesis ($H_0$) is that both populations (model output data) are the same and the alternate hypothesis ($H_1$) is that one particular model (LU or NLU) has greater values than the other.

\label[model_comp]
\sec Model comparissons

The scenario of this simulation is of loam soil, medium root length density, high potential transpiration and high initial concentration (Table \ref[general_param]). 
We compare all model types (no solute uptake -- NU; constant -- CU; linear -- LU and nonlinear -- NLU concentration dependent uptake rates). 
All simulations were made until the value of relative transpiration was equal or less than 0.001. 
The time step is dynamic (depends on the number of iterations of the previous time step for water and solute equations) and was set to vary between 0.1 and 2 seconds. 
The simulation for NU ended within near 3 days; for CU, LU and NLU, about 5 days.

%CONSIDERATIONS:
%•	It is not considered root growth
%•	It is not considered movement of solute inside the plant
%•	There is no maximum uptake. The Im value is considered to be the plant demand. The maximum flux is dependent on water flux times concentration in soil solution at root surface
%•	The model does not act like as an infinite sink (all solute that arrives the root is extracted)
%•	The model does not include extraction by root hairs. In some cases (like extraction of P) it can contribute 60% to 90% of the uptake
%•	It does not consider complementary ion effects
%•	It does not consider soil buff power
%•	See 21.pdf for limitations in measurement of MM parameters

\label[sensitivity]
\sec Sensitivity analysis

